<!doctype html>
<html lang="he_IL" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link href="vendor/css/material-dashboard.css" rel="stylesheet" />
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">

    <link rel="shortcut icon" type="image/x-icon" href="img/favico.ico" />

    <link rel="stylesheet" href="vendor/css/style.css" type="text/css">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/64d58efce2.js" crossorigin="anonymous"></script>

    <title>עריכת משלוח</title>
    <style>
        label {
            display: inline-block;
            color: black;
            cursor: pointer;
            position: relative;
        }

        label span {
            display: inline-block;
            position: relative;
            background-color: transparent;
            width: 25px;
            height: 25px;
            transform-origin: center;
            border: 2px solid #32cb87;
            border-radius: 50%;
            vertical-align: -6px;
            margin-right: 10px;
            transition: background-color 150ms 200ms, transform 350ms cubic-bezier(0.78, -1.22, 0.17, 1.89);
        }

        label span:before {
            content: "";
            width: 0px;
            height: 2px;
            border-radius: 2px;
            background: var(--color-primary);
            position: absolute;
            transform: rotate(45deg);
            top: 10px;
            left: 7px;
            transition: width 50ms ease 50ms;
            transform-origin: 0% 0%;
        }

        label span:after {
            content: "";
            width: 0;
            height: 2px;
            border-radius: 2px;
            background: var(--color-primary);
            position: absolute;
            transform: rotate(305deg);
            top: 13px;
            left: 8px;
            transition: width 50ms ease;
            transform-origin: 0% 0%;
        }

        label:hover span:before {
            width: 5px;
            transition: width 100ms ease;
        }

        label:hover span:after {
            width: 10px;
            transition: width 150ms ease 100ms;
        }

        input[type="checkbox"] {
            display: none;
            margin: 0 10px 0 10px;
        }

        input[type="checkbox"]:checked+label span {
            background-color: #32cb87;
            transform: scale(1);
        }

        input[type="checkbox"]:checked+label span:after {
            width: 10px;
            background: white;
            transition: width 150ms ease 100ms;
        }

        input[type="checkbox"]:checked+label span:before {
            width: 5px;
            background: white;
            transition: width 150ms ease 100ms;
        }

        input[type="checkbox"]:checked+label:hover span {
            background-color: #32cb87;
            transform: scale(1);
        }

        input[type="checkbox"]:checked+label:hover span:after {
            width: 10px;
            background: white;
            transition: width 150ms ease 100ms;
        }

        input[type="checkbox"]:checked+label:hover span:before {
            width: 5px;
            background: white;
            transition: width 150ms ease 100ms;
        }
    </style>

</head>
<div id="loader-wrapper">
    <div id="loader"></div>

    <div class="loader-section section-left"></div>
    <div class="loader-section section-right"></div>

</div>

<body id="orderssummary">
    <div id="lock-modal"></div>
    <div id="loading-circle"></div>
    <div style="clear:both"></div>

    <div class="wrapper ">
        <div id="sidebar" class="sidebar" data-color="green">
        </div>

        <div class="main-panel">
            <!-- Navbar -->
            <nav id="navbar" class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">

            </nav> <!-- End Navbar -->
            <div class="content">
                <div class="container-fluid">

                    <div class="wrapper">


                        <div class="container">
                            <div class="row">
                                <h3 class="heading">עדכון משלוח</h3>



                                <section id="createdelivery">
                                    <div class="row justify-content-md-center">
                                        <div class="col col-lg-2 col-md-3  col-sm-4">
                                            <button class="btn_dir " id="to_target" value="1"
                                                onclick="clickbtndir_onupdate(this.id)"><span></span>ממני אל
                                                היעד</button>
                                        </div>
                                        <div class="col col-lg-2 col-md-3  col-sm-4">
                                            <button class="btn_dir" id="from_target" value="22"
                                                onclick="clickbtndir_onupdate(this.id)"><span></span>מהיעד אליי</button>
                                        </div>
                                        <div class="col col-lg-2 col-md-3 col-sm-4">
                                            <button class="btn_dir" id="from_target_to_target" value="333"
                                                onclick="clickbtndir_onupdate(this.id)"><span></span> מיעד
                                                ליעד</button>
                                        </div>
                                    </div>
                                    <div class="container containercreate">
                                        <div class="forms-container">

                                            <form onsubmit="showpopup('UpdateShipment')" id="formupdatedelivery"
                                                class="row g-3">

                                                <div class="expand ">
                                                    <button type="button" id="btn-sender-fav"
                                                        class="btn favorite sender-favorite " value="sender"
                                                        onclick="favbuttonclick(this)"> <span class="bx bxs-star" /> בחר
                                                        מהמועדפים שלי</button>
                                                    <br><br>
                                                    <div class="expand-deatials">
                                                        <div class="title">
                                                            <button class="btn-primary btn_expand" type="button"
                                                                onclick="changeicon('#'+this.id);" id="collapsesender">
                                                                <i class='bx bx-minus'></i>

                                                            </button>

                                                            <h3>שולח</h3>


                                                        </div>
                                                        <div class="collapse show senderdeatials deatials"
                                                            id="sender-collapse">
                                                            <div class="form-row">
                                                                <div class="col-md-4 input-field ">
                                                                    <input type="text"
                                                                        class="form-control sender sendername"
                                                                        id="sendername" placeholder="שם מלא" required>

                                                                </div>

                                                                <div class="col-md-4 input-field ">
                                                                    <input type="text"
                                                                        class="form-control sender senderaddress"
                                                                        id="senderaddress" placeholder="כתובת" required>

                                                                </div>
                                                                <div class="col-md-4 input-field ">
                                                                    <input type="text"
                                                                        class="form-control sender sendercity"
                                                                        id="sendercity" placeholder="עיר" required>
                                                                </div>
                                                            </div>
                                                            <div class="form-row">
                                                                <div class="col-md-4 input-field">
                                                                    <input type="tel"
                                                                        class="form-control sender senderphone"
                                                                        id="senderphone" placeholder="מספר טלפון"
                                                                        required>
                                                                </div>
                                                                <div class="col-md-4 input-field">
                                                                    <input type="email"
                                                                        class="form-control sender senderemail"
                                                                        id="senderemail"
                                                                        placeholder="כתובת מייל (לא חובה)">
                                                                </div>
                                                                <div class="col-md-4 input-field">
                                                                    <input type="tel"
                                                                        class="form-control sender senderphone2"
                                                                        id="senderphone2"
                                                                        placeholder="מספר טלפון משני (לא חובה)">
                                                                </div>
                                                            </div>
                                                            <div class="form-row">
                                                                <div class="col-md-8 input-field">
                                                                    <input type="text"
                                                                        class="form-control sender sendercomment"
                                                                        id="sendercomment" placeholder="הערה (לא חובה)">
                                                                </div>
                                                                <div class="col-md-2 ">
                                                                    <div class="exp" id="exp-check-sender">
                                                                        <div class="checkbox">

                                                                            <input type="checkbox" id="check-sender"
                                                                                name="check" class="sender" value="" />
                                                                            <label for="check-sender">

                                                                                <span>
                                                                                    <!-- This span is needed to create the "checkbox" element -->
                                                                                </span>
                                                                                הוסף למועדפים שלי
                                                                            </label>

                                                                        </div>
                                                                    </div>

                                                                </div>

                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="container">
                                                    <div class="row">
                                                        <div class="col">
                                                            <div class="changedirdiv">
                                                                <button type="button" class="changedir"
                                                                    onclick="changedir();">
                                                                    <i class="fas fa-exchange-alt fa-rotate-90 fa-2x"
                                                                        style="color:var(--color-primary) !important;"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="expand">
                                                    <button id="btn-receiver-fav" type="button"
                                                        class="btn favorite receiver-favorite" value="receiver"
                                                        onclick="favbuttonclick(this)"><span class="bx bxs-star" /> בחר
                                                        מהמועדפים שלי</button>
                                                    <br><br>
                                                    <div class="expand-deatials">
                                                        <div class="title">
                                                            <button class=" btn-primary btn_expand" type="button"
                                                                onclick="changeicon('#'+this.id);"
                                                                id="collapsereceiver">
                                                                <i class='bx bx-minus'></i>

                                                            </button>
                                                            <h3>מקבל</h3>
                                                        </div>

                                                        <div class="collapse show receiverdeatials deatials"
                                                            id="receiver-collapse">
                                                            <div class="form-row">
                                                                <div class="col-md-4 input-field ">
                                                                    <input type="text"
                                                                        class="form-control receiver receivername"
                                                                        id="receivername" placeholder="שם מלא" required>

                                                                </div>
                                                                <div class="col-md-4 input-field ">
                                                                    <input type="text"
                                                                        class="form-control receiver receiveraddress"
                                                                        id="receiveraddress" placeholder="כתובת"
                                                                        required>
                                                                </div>
                                                                <div class="col-md-4 input-field ">
                                                                    <input type="text"
                                                                        class="form-control receiver receivercity"
                                                                        id="receivercity" placeholder="עיר" required>
                                                                </div>
                                                            </div>
                                                            <div class="form-row">
                                                                <div class="col-md-4 input-field">
                                                                    <input type="tel"
                                                                        class="form-control receiver receiverphone"
                                                                        id="receiverphone" placeholder="מספר טלפון"
                                                                        required>
                                                                </div>
                                                                <div class="col-md-4 input-field">
                                                                    <input type="email"
                                                                        class="form-control receiver receiveremail"
                                                                        id="receiveremail"
                                                                        placeholder="כתובת מייל (לא חובה)">
                                                                </div>
                                                                <div class="col-md-4 input-field">
                                                                    <input type="tel"
                                                                        class="form-control receiver receiverphone2"
                                                                        id="receiverphone2"
                                                                        placeholder="מספר טלפון משני (לא חובה)">
                                                                </div>
                                                            </div>
                                                            <div class="form-row">
                                                                <div class="col-md-8 input-field">
                                                                    <input type="text"
                                                                        class="form-control receiver receivercomment"
                                                                        id="receivercomment"
                                                                        placeholder="הערה (לא חובה)">
                                                                </div>
                                                                <div class="col-md-2 ">
                                                                    <div class="exp" id="exp-check-receiver">
                                                                        <div class="checkbox">

                                                                            <input type="checkbox" id="check-receiver"
                                                                                name="check" value=""
                                                                                class="receiver" />
                                                                            <label for="check-receiver">

                                                                                <span>
                                                                                    <!-- This span is needed to create the "checkbox" element -->
                                                                                </span>
                                                                                הוסף למועדפים שלי
                                                                            </label>

                                                                        </div>
                                                                    </div>

                                                                </div>

                                                            </div>


                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="container-fluid">
                                                    <div class="form-row">
                                                        <div class="col-md-6" style="margin-bottom: 20px;">
                                                            <div class="input-field select">
                                                                <select list="distributor"
                                                                    class="form-control deliverydistributor"
                                                                    name="distributor" id="distributor" required>
                                                                    <datalist id="distributor">
                                                                        <option value="" disabled selected hidden>שם
                                                                            מפיץ</option>
                                                                    </datalist>
                                                                </select>
                                                            </div>

                                                        </div>

                                                        <div class="col-md-6" style="margin-bottom: 20px;">
                                                            <div class="input-field select">
                                                                <select list="type" class="form-control deliverytype"
                                                                    name="type" id="type" required>
                                                                    <datalist id="type">
                                                                        <option value="" disabled selected hidden>
                                                                            סוג משלוח</option>
                                                                        <option id="regular" value="רגילה">רגילה
                                                                        </option>
                                                                        <option id="double" value="כפולה">כפולה
                                                                        </option>
                                                                        <option id="payment" value="גוביינא">
                                                                            גוביינא</option>

                                                                    </datalist>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">

                                                        <div class="col-md-6 input-field ">
                                                            <input type="text" class="form-control route" id="route"
                                                                placeholder="מספר מסלול (לא חובה)">

                                                        </div>
                                                        <div class="col-md-6 input-field ">
                                                            <input type="text" class="form-control externalid"
                                                                id="externalid"
                                                                placeholder="מספר מזהה חיצוני (לא חובה)">

                                                        </div>

                                                    </div>
                                                    <div class="form-row govina">
                                                        <div class="col-md-12 input-field">
                                                            <input type="text" class="form-control moneycollect "
                                                                id="moneycollect" placeholder="סכום גוביינא">
                                                        </div>
                                                    </div>

                                                </div>


                                                <div class="row" id="buttons">
                                                    <div class="col">

                                                        <button type="submit" id="btn_create"
                                                            class="btn btn_create">עדכן משלוח</button>
                                                    </div>
                                                </div>



                                            </form>

                                        </div>
                                    </div>
                                </section>
                                <div id="UpdateShipment" class="UpdateShipment modal-small-wrapper">

                                    <div class="modal-small modal-update-shipment">
                                        <span class="close" onclick="closepopup('UpdateShipment')">&times;</span>
                                        <br>
                                        <p>בטוחים שתרצו לעדכן משלוח זה?</p>
                                        <button class=" btn-primary btn-cancel"
                                            onclick="closepopup('UpdateShipment')">לא</button>
                                        <button class=" btn-primary btn-ok" onclick="updateDelivery()">כן</button>

                                    </div>

                                </div>
                            </div>

                        </div>



                        <div class="popup-container" id="favorite-popup">
                            <div class="popup-table">
                                <div class="popup-table-cell">
                                    <div class="popup">

                                        <div class="title">
                                            המועדפים שלי
                                            <span class="closepopup"
                                                onclick="closepopup('favorite-popup')">&times;</span>

                                        </div>
                                        <div class="content">
                                            <table class="rwd-table" id="rwd-table">
                                                <thead>
                                                    <tr>
                                                        <th>מספר מזהה</th>
                                                        <th>שם מלא</th>
                                                        <th>כתובת מלאה</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbody"></tbody>

                                            </table>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>

        </div>

    </div>


    <script src="vendor/jquery/jquery.min.js"></script>

    <script src="vendor/js/popper.min.js"></script>
    <script src="vendor/js/material-dashboard.js"></script>
    <script src="vendor/js/bootstrap-material-design.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js.map"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-analytics.js"></script>

    <script type="text/javascript " src="vendor/js/main.js"></script>
    <script type="text/javascript " src="vendor/js/app.js"></script>
    <script>
        window.onload = checkuser();

        analytics.logEvent('A new Entry in Create Delivery page');

        window.load = load()
        window.onload = createTableFavorites(true);

        const buttons = document.getElementById("buttons");
        buttons.style.marginTop = "-50px";

        const formupdatedelivery = document.getElementById("formupdatedelivery");
        formupdatedelivery.addEventListener("submit", (e) => {
            e.preventDefault();


        });

        $(".btn-ok").on("click", function (e) {
            closepopup("UpdateShipment");

        })



        function load() {
            appendDistributors();
            disbaleinputs("sender", true);

            // order_no = getKeyWordFromQuery("dno")

            order_no = localStorage.getItem("OrderNo");
            mydata = localStorage.getItem(order_no);
            myData = JSON.parse(mydata);
            const DROPOFFPOINT = myData["DropOffPoint"];
            const SHIPMENTINFO = myData["ShipmentInfo"];
            const PICKUPPOINT = myData["PickUpPoint"];

            putinfoininputfromdb(PICKUPPOINT, "sender");
            putinfoininputfromdb(DROPOFFPOINT, "receiver");

            document.getElementById("distributor").value = SHIPMENTINFO.Distributor.DBName;
            document.getElementById("type").value = SHIPMENTINFO.Type;
            document.getElementById("externalid").value = SHIPMENTINFO.Externalid;
            document.getElementById("moneycollect").value = SHIPMENTINFO.Govina;

            if ("Route" in SHIPMENTINFO) {
                document.getElementById("route").value = SHIPMENTINFO.Route;

            }

            const from_me = document.querySelector("#to_target");
            const to_me = document.querySelector("#from_target");
            const target_to_target = document.querySelector("#from_target_to_target");

            direction = SHIPMENTINFO.Direction;
            if (direction == "ממני אל היעד") {
                addactive("to_target");
            }
            else if (direction == "מהיעד אליי") {
                addactive("from_target");

            }
            else if (direction == "מיעד ליעד") {
                addactive("from_target_to_target");

            }
            else {
                addactive("to_target");

            }



        }
        window.onload = putCompanyDeatials_trigger("sender");

        $('#distributor').on('change', function (e) {
            var optionSelected = $("option:selected", this);
            var valueSelected = this.value;
            var typeSelected = document.getElementById("type");
            var valuetype = typeSelected.value;

            if (valueSelected.startsWith("GetPackage") || valueSelected.startsWith("Boutique24")) {
                if (valuetype == "גוביינא" || valuetype == "כפולה") {
                    document.getElementById("type").value = "";
                }
                document.getElementById("double").disabled = true;
                document.getElementById("payment").disabled = true;
            }
            else {
                document.getElementById("double").disabled = false;
                document.getElementById("payment").disabled = false;

            }

        });

        $('#type').on('change', function (e) {
            var optionSelected = $("option:selected", this);
            var valueSelected = this.value;
            var id = optionSelected[0]["id"]


            const moneycollect = document.getElementById("moneycollect")
            const buttons = document.getElementById("buttons");

            if (id == "payment") {

                moneycollect.style.visibility = "visible";
                buttons.style.marginTop = "0px";

            }
            else {

                moneycollect.style.visibility = "hidden";
                buttons.style.marginTop = "-50px";


            }

        });


        $(".btn_dir").on("click", function (e) {
            id = this.id
            check_dir_for_distributor(id);
        });

        $(".changedir").on("click", function (e) {
            const from_me = document.querySelector("#to_target");
            const to_me = document.querySelector("#from_target");
            const target_to_target = document.querySelector("#from_target_to_target");


            if (from_me.classList.contains("active")) {
                check_dir_for_distributor(from_me.id);
            } else if (to_me.classList.contains("active")) {
                check_dir_for_distributor(to_me.id);
            } else {
                check_dir_for_distributor(target_to_target.id);
            }
        })


        $("#collapsesender").click(function () {
            $("#sender-collapse").collapse('toggle');
        });
        $("#collapsereceiver").click(function () {
            $("#receiver-collapse").collapse('toggle');
        });

    </script>

</body>

</html>